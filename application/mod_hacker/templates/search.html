{% extends "hacker.base.html" %}

{% block content %}
{% include "navbar.html" %}

<div class="page-container">
  <div class="page-section" id="settings">
    <div class="container">
      <h2>Search</h2>
        
      <table id="participant-table">
        <tr>
          <th>First Name</th>
          <th>Last Name</th>
          <th>Email</th> 
          <th>Account Type</th>
          <th>Account Status</th>
          <th>School</th>
        </tr>
        <tr>
          <th>
            <input type="text" class="filter-field" id="filter-firstname"/>
          </th>
          <th>
            <input type="text" class="filter-field" id="filter-lastname"/>
          </th>
          <th>
            <input type="text" class="filter-field" id="filter-email"/>
          </th>
          <th>
            <select class="filter-field" id="filter-type_account">
              <option></option>
              <option value="hacker">Hacker</option>
              <option value="mentor">Mentor</option>
              <option value="scholarship">Scholarship</option>
            </select>
          </th>
          <th>
            <select class="filter-field" id="filter-status">
              <option></option>
              <option value="Not Started">Not Started</option>
              <option value="In Progress">In Progress</option>
              <option value="Submitted">Submitted</option>
            </select>
          </th>
          <th>
            <input type="text" class="filter-field" id="filter-school"/>
          </th>
        </tr>
      </table>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script type="text/javascript">
  var participants = {{ participants|safe }};
  
  var participantTable = document.getElementById("participant-table");
  var pageSize = 50;

  var participantFields = ["firstname", "lastname", "email", "type_account", "status", "school"];

  for(var i = 0; i < participants.length; i++){
    var tableEntry = document.createElement("tr");
    tableEntry.id = participants[i].id;

    for(var j = 0; j < participantFields.length; j++){
      var column = document.createElement("td");
      column.appendChild(document.createTextNode(participants[i][participantFields[j]]));
      column.classList.add("user-" + participantFields[j]);
      tableEntry.appendChild(column);
    }
    participantTable.getElementsByTagName("tbody")[0].appendChild(tableEntry);
  }

  filter = function(filterVals){
    for(var i = 0; i < participants.length; i++){
      var show = true;
      for(var j = 0; j < filterVals.length; j++){
        var criteria = filterVals[j];
        var field = criteria[0];
        var partialVal = criteria[1].toLowerCase();
        if(participants[i][field].toLowerCase().indexOf(partialVal) == -1){
          show = false;
        }
      }
      var tableEntry = document.getElementById(participants[i].id);
      if(show){
        tableEntry.classList.remove("hide");
      }
      else{
        tableEntry.classList.add("hide");
      }
    }
  }

  getFilterVals = function(){
    var filterVals = [];
    for(var i = 0; i < participantFields.length; i++){
      var filterField = document.getElementById("filter-" + participantFields[i]);
      if(filterField){
        filterVals.push([participantFields[i], filterField.value]);
      }
    }
    return filterVals;
  }

  var filterFields = document.getElementsByClassName("filter-field");
  for(var i = 0; i < filterFields.length; i++){
    filterFields[i].onchange = function(){
      filter(getFilterVals());
    }
  }

  xttpObj = new XTPHttpRequest;
  xttpObj.open("GET", "/api/get_participants?page_num=0&page_size=100", true); //True means async
  xttpObj.send()

  //Access response with xttpObj.responseText
</script>
{% endblock %}